pipeline {
    agent any

    environment {
        PYTHON_BIN = '/usr/bin/python3.13' // full path to python3.13
    }

    stages {
        stage('Clean Workspace') {
            steps {
                cleanWs() // Clean previous build files
            }
        }

        stage('Install Dependencies') {
            steps {
                sh '''
                    apt-get update
                    apt-get install -y python3 python3-pip python3-venv
                '''
            }
        }

        stage('Setup Virtual Environment') {
            steps {
                sh '''
                    $PYTHON_BIN -m venv venv
                    . venv/bin/activate
                    pip install --upgrade pip
                    pip install pytest
                '''
            }
        }

        stage('Verify Files') {
            steps {
                sh '''
                    echo "Checking files in workspace:"
                    pwd
                    ls -R
                '''
            }
        }

        stage('Run Test Stage 1') {
            steps {
                sh '''
                    . venv/bin/activate
                    pytest tests/test_part1.py
                '''
            }
        }

        stage('Run Test Stage 2') {
            steps {
                sh '''
                    . venv/bin/activate
                    pytest tests/test_part2.py
                '''
            }
        }

        stage('Run Test Stage 3') {
            steps {
                sh '''
                    . venv/bin/activate
                    pytest tests/test_part3.py
                '''
            }
        }
    }
}
